<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>今日だけ見る｜家族旅行しおり</title>

<style>
:root{
  --bg:#0b1020;
  --card:#111c35;
  --text:#e7eefc;
  --muted:#b7c3df;
  --line:rgba(231,238,252,.12);
  --accent:#66a3ff;
  --radius:18px;
  --shadow:0 12px 28px rgba(0,0,0,.35);
}

*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);
font-family:system-ui,-apple-system,"Noto Sans JP","Yu Gothic",sans-serif;}

.wrap{max-width:980px;margin:auto;padding:16px}

/* ===== ヘッダー ===== */
.topbar{
  display:flex;flex-wrap:wrap;gap:10px;
  justify-content:space-between;align-items:center;
  padding:12px 14px;background:#0f172a;
  border:1px solid var(--line);border-radius:var(--radius);
  position:sticky;top:8px;z-index:10;
}
.brand .ttl{font-weight:800}
.brand .sub{font-size:12px;color:var(--muted)}

.controls{display:flex;gap:8px}
select,button{
  background:#111c35;color:var(--text);
  border:1px solid var(--line);
  border-radius:12px;padding:8px 12px;
}

/* ===== カード ===== */
.card{
  margin-top:14px;padding:14px;
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
.titleRow{
  display:flex;justify-content:space-between;align-items:center;
}
.badge{
  font-size:12px;border:1px solid var(--line);
  padding:4px 8px;border-radius:999px;
}
.hr{height:1px;background:var(--line);margin:12px 0}

/* ===== 抽出コンテンツ整理 ===== */
.content img,
.content figure,
.content picture,
.content figcaption{display:none!important;} /* 写真ゼロ */

.content :is(h1,h2,h3,h4,h5,h6):first-of-type{
  display:none!important; /* DAY見出し重複防止 */
}

/* 説明文（段落）は消す */
.content p{display:none!important;}

/* 行程・表は残す */
.content ul,.content ol,.content li{display:list-item}
.content table{width:100%;border-collapse:collapse;margin-top:8px}
.content th,.content td{
  border-bottom:1px solid var(--line);
  padding:8px;font-size:14px
}
.content tr:last-child td{border-bottom:none}

.footer{margin-top:12px;font-size:12px;color:var(--muted);text-align:center}
.error{color:#ffb4b4}
</style>
</head>

<body>
<div class="wrap">

<!-- ===== 上部 ===== -->
<div class="topbar">
  <div class="brand">
    <div class="ttl">今日だけ見る｜家族旅行しおり</div>
    <div class="sub">本編（トップ）からDAY内容のみ表示</div>
  </div>
  <div class="controls">
    <select id="daySelect"></select>
    <button id="btnToday">今日に戻す</button>
    <button id="btnOpenMain">本編</button>
  </div>
</div>

<!-- ===== 本体 ===== -->
<div class="card">
  <div class="titleRow">
    <h1 id="headline">読み込み中…</h1>
    <div class="badge" id="badge">—</div>
  </div>
  <div class="hr"></div>
  <div id="content" class="content"></div>
  <div class="footer">家族LINEには /today.html だけ送ればOK</div>
</div>

</div>

<script>
const TRIP_START = new Date('2026-02-09T00:00:00+09:00');
const TRIP_DAYS = 7;
const DAY_RE = /◆\s*(\d+)\s*日目｜/;

function clamp(n,min,max){return Math.max(min,Math.min(max,n));}
function todayDay(){
  const a=Date.UTC(TRIP_START.getFullYear(),TRIP_START.getMonth(),TRIP_START.getDate());
  const b=Date.UTC(new Date().getFullYear(),new Date().getMonth(),new Date().getDate());
  return clamp(Math.floor((b-a)/86400000)+1,1,TRIP_DAYS);
}
function fillSelect(d){
  daySelect.innerHTML='';
  for(let i=1;i<=TRIP_DAYS;i++){
    const o=document.createElement('option');
    o.value=i;o.textContent=`DAY ${i}`;
    if(i===d)o.selected=true;
    daySelect.appendChild(o);
  }
}

async function loadDay(day){
  fillSelect(day);
  content.innerHTML='';
  try{
    const html=await (await fetch('./index.html',{cache:'no-store'})).text();
    const doc=new DOMParser().parseFromString(html,'text/html');
    const heads=[...doc.querySelectorAll('h1,h2,h3,h4,h5,h6')]
      .map(h=>({h,m:(h.textContent||'').match(DAY_RE)}))
      .filter(x=>x.m)
      .map(x=>({el:x.h,day:+x.m[1]}));

    const t=heads.find(x=>x.day===day);
    if(!t){content.innerHTML='<div class="error">DAYが見つかりません</div>';return;}

    headline.textContent=(t.el.textContent||'').replace(/^◆\s*/,'');
    badge.textContent=`DAY ${day}/${TRIP_DAYS}`;

    const sib=[...t.el.parentElement.children];
    const i=sib.indexOf(t.el);
    for(let n=i;n<sib.length;n++){
      if(n!==i && DAY_RE.test(sib[n].textContent||''))break;
      content.appendChild(sib[n].cloneNode(true));
    }
  }catch(e){
    content.innerHTML='<div class="error">読み込み失敗</div>';
  }
}

const daySelect=document.getElementById('daySelect');
const content=document.getElementById('content');
const headline=document.getElementById('headline');
const badge=document.getElementById('badge');

loadDay(todayDay());
daySelect.onchange=e=>loadDay(+e.target.value);
btnToday.onclick=()=>loadDay(todayDay());
btnOpenMain.onclick=()=>window.open('./','_blank');
</script>
</body>
</html>
